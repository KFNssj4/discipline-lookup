<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Discipline Action Lookup</title>
  <style>
    :root {
      --bg: #dce7f5;
      --bgAccent: #b6c8e1;
      --surface: #ffffff;
      --surfaceSoft: #eef3fa;
      --ink: #0b1a2f;
      --inkMuted: #344963;
      --line: #a9bdd8;
      --brand: #061733;
      --brandSoft: #d4e0f2;
      --focus: #0d2b59;
      --danger: #9e1b1b;
      --dangerBg: #fde9e9;
      --shadow: 0 18px 44px rgba(6, 23, 51, 0.2);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Nunito Sans", "Avenir Next", "Trebuchet MS", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 10% 10%, var(--bgAccent) 0%, transparent 40%),
        radial-gradient(circle at 100% 0%, #9eb4d2 0%, transparent 32%),
        var(--bg);
      min-height: 100vh;
    }

    .wrap {
      max-width: 900px;
      margin: 48px auto;
      padding: 0 18px;
    }

    .card {
      background: var(--surface);
      border: 1px solid rgba(6, 23, 51, 0.24);
      border-radius: 20px;
      padding: 26px;
      box-shadow: var(--shadow);
    }

    .brandHeader {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 2px;
    }

    .logoWrap {
      width: 64px;
      height: 64px;
      border-radius: 14px;
      border: 1px solid rgba(6, 23, 51, 0.3);
      background: #fff;
      display: grid;
      place-items: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .logoWrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.4rem, 2.3vw, 1.95rem);
      line-height: 1.2;
      letter-spacing: 0.01em;
      color: var(--brand);
    }

    .subhead {
      margin: 3px 0 0;
      font-size: clamp(1rem, 1.6vw, 1.15rem);
      color: var(--inkMuted);
      font-weight: 700;
    }

    p {
      margin: 0 0 22px;
      color: var(--inkMuted);
      max-width: 68ch;
      line-height: 1.5;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 230px;
      gap: 14px;
      align-items: end;
    }

    label {
      font-size: 0.8rem;
      color: var(--inkMuted);
      font-weight: 700;
      display: block;
      margin-bottom: 7px;
    }

    select,
    input {
      width: 100%;
      padding: 12px 13px;
      border: 1px solid var(--line) !important;
      border-radius: 12px !important;
      font-size: 0.96rem;
      color: var(--ink);
      background-color: var(--surface) !important;
      -webkit-appearance: none;
      appearance: none;
      outline: none !important;
      box-shadow: none !important;
      background-image: none !important;
      transition: border-color 0.18s ease, box-shadow 0.18s ease, transform 0.18s ease;
    }

    #count {
      background:
        linear-gradient(45deg, transparent 50%, var(--inkMuted) 50%) calc(100% - 18px) calc(1em + 1px) / 5px 5px no-repeat,
        linear-gradient(135deg, var(--inkMuted) 50%, transparent 50%) calc(100% - 13px) calc(1em + 1px) / 5px 5px no-repeat,
        var(--surface);
      padding-right: 34px;
    }

    select:focus,
    input:focus,
    input:focus-visible,
    input:active {
      border-color: var(--focus) !important;
      box-shadow: 0 0 0 4px rgba(25, 113, 194, 0.14) !important;
      transform: translateY(-1px);
    }

    input:-webkit-autofill,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px var(--surface) inset !important;
      -webkit-text-fill-color: var(--ink) !important;
    }

    .inputWrap { position: relative; }

    .suggestions {
      position: absolute;
      top: calc(100% + 7px);
      left: 0;
      right: 0;
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 16px 34px rgba(17, 36, 58, 0.16);
      max-height: 290px;
      overflow: auto;
      z-index: 50;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
      animation: suggestionsIn 0.16s ease-out;
    }

    .suggestion {
      padding: 11px 13px;
      cursor: pointer;
      font-size: 0.93rem;
      line-height: 1.25;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: pan-y;
      border-bottom: 1px solid #edf2f7;
    }

    .suggestion:last-child { border-bottom: 0; }

    .suggestion:hover,
    .suggestion.active {
      background: var(--surfaceSoft);
      color: var(--brand);
    }

    .notice {
      margin-top: 15px;
      padding: 11px 13px;
      border-radius: 12px;
      border: 1px solid rgba(158, 27, 27, 0.35);
      background: var(--dangerBg);
      color: var(--danger);
      font-weight: 700;
      display: none;
    }

    .result {
      margin-top: 14px;
      padding: 17px;
      border: 1px solid rgba(6, 23, 51, 0.24);
      border-radius: 14px;
      background: linear-gradient(180deg, #ffffff 0%, #f1f6fd 100%);
    }

    .result h2 {
      margin: 0 0 8px;
      color: var(--brand);
      font-size: 0.84rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .result .action {
      font-size: clamp(1.02rem, 2vw, 1.16rem);
      font-weight: 800;
      line-height: 1.42;
      white-space: pre-line;
    }

    .footer {
      margin-top: 12px;
      font-size: 0.79rem;
      color: var(--inkMuted);
      border-top: 1px dashed #d5e1ed;
      padding-top: 10px;
    }

    @keyframes suggestionsIn {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 700px) {
      .wrap { margin: 24px auto; }
      .card { padding: 20px; border-radius: 16px; }
      .brandHeader { gap: 10px; }
      .logoWrap { width: 54px; height: 54px; border-radius: 12px; }
      .grid { grid-template-columns: 1fr; }
      .result .action { font-size: 1.03rem; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brandHeader">
        <div class="logoWrap">
          <img
            src="achigh.png"
            alt="School logo"
          />
        </div>
        <div>
          <h1>Atlantic City High School</h1>
          <div class="subhead">Discipline Action Lookup</div>
        </div>
      </div>
      <p>Select an offense and the infraction count to see the recommended action.</p>

      <div class="grid">
        <div>
          <label for="offenseInput">Offense</label>

          <div class="inputWrap">
            <input
              id="offenseInput"
              placeholder="Type to search or click to browse…"
              autocomplete="off"
              autocapitalize="none"
              autocorrect="off"
              spellcheck="false"
            />
            <div id="suggestions" class="suggestions" hidden></div>
          </div>
        </div>

        <div>
          <label for="count">Infraction count</label>
          <select id="count">
            <option value="1">1st offense</option>
            <option value="2">2nd offense</option>
            <option value="3">3rd+ offense</option>
          </select>
        </div>
      </div>

      <div class="notice" id="unlawfulNotice">Unlawful act (may require law enforcement / district reporting per policy).</div>

      <div class="result" id="result" aria-live="polite">
        <h2>Action</h2>
        <div class="action" id="actionText">Loading…</div>
        <div class="footer" id="meta"></div>
      </div>
    </div>
  </div>

<script>
  let matrix = [];
  let selectedRow = null;         // set when user picks a suggestion
  let isLockedSelection = false;  // stays locked until user types again

  function normalizeCount(v) {
    const n = Number(v);
    if (Number.isNaN(n) || n <= 1) return 1;
    if (n === 2) return 2;
    return 3; // 3+
  }

  function getAction(row, count) {
    if (!row) return "Type or browse offenses to see the recommended action.";
    const c = normalizeCount(count);
    if (c === 1) return row.action1 || "(No action listed for 1st offense)";
    if (c === 2) return row.action2 || "(No action listed for 2nd offense)";
    return row.action3 || "(No action listed for 3rd+ offense)";
  }

  function norm(s) {
    return (s || "").toString().trim().toLowerCase();
  }

  // Forgiving search key: lowercased, punctuation removed, spaces normalized
  function makeSearchKey(s) {
    return norm(s)
      .replace(/['’]/g, "")
      .replace(/[^a-z0-9]+/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }

  function tokenize(s) {
    const key = makeSearchKey(s);
    return key ? key.split(" ") : [];
  }

  // Query token variants to catch common cases like vape -> vaping (silent e)
  function variantsForToken(qt) {
    const v = [];
    if (!qt) return v;
    v.push(qt);

    // silent-e drop: "vape" -> "vap" (so it matches "vaping")
    if (qt.endsWith("e") && qt.length > 2) v.push(qt.slice(0, -1));

    // de-dupe
    return [...new Set(v)];
  }

  // Option A behavior:
  // - Empty query => show ALL offenses
  // - Non-empty => score and filter
  function getMatches(query) {
    const qKey = makeSearchKey(query);

    // Empty: return everything (already sorted in init)
    if (!qKey) return matrix.slice();

    const qTokens = qKey.split(" ").filter(Boolean);

    const scored = [];

    for (const r of matrix) {
      const key = r._searchKey;
      const tokens = r._tokens;

      let startScore = 0;
      let containScore = 0;

      for (const qt of qTokens) {
        const vars = variantsForToken(qt);

        // Strong: any word starts with token variant
        const wordStartMatch = vars.some(v => tokens.some(t => t.startsWith(v)));
        if (wordStartMatch) {
          startScore += 2;
          continue;
        }

        // Weaker: anywhere in key
        const containsMatch = vars.some(v => key.includes(v));
        if (containsMatch) containScore += 1;
      }

      const totalScore = startScore + containScore;
      if (totalScore > 0) scored.push({ row: r, score: totalScore });
    }

    // Higher score first; tie-break alphabetically
    scored.sort((a, b) => (b.score - a.score) || a.row.offense.localeCompare(b.row.offense));

    return scored.map(x => x.row);
  }

  function topMatch(query) {
    const matches = getMatches(query);
    // For empty query, "top match" should be first offense alphabetically
    return matches.length ? matches[0] : null;
  }

  function renderAction(row) {
    const countSel = document.getElementById("count");
    const actionText = document.getElementById("actionText");
    const meta = document.getElementById("meta");
    const notice = document.getElementById("unlawfulNotice");

    actionText.textContent = getAction(row, countSel.value);
    notice.style.display = (row && row.unlawful === true) ? "block" : "none";

    const label = countSel.value === "1" ? "1st" : (countSel.value === "2" ? "2nd" : "3rd+");
    meta.textContent = row ? `${row.offense} • ${label} offense` : "";
  }

  function showSuggestions(matches, activeIndex = 0) {
  const box = document.getElementById("suggestions");

  if (!matches.length) {
    box.hidden = true;
    box.innerHTML = "";
    return;
  }

  // Render ALL offenses (Option A). The box scrolls.
  box.hidden = false;
  box.innerHTML = matches.map((r, i) => `
    <div class="suggestion ${i === activeIndex ? "active" : ""}" data-offense="${escapeHtml(r.offense)}">
      ${escapeHtml(r.offense)}
    </div>
  `).join("");

  box.querySelectorAll(".suggestion").forEach(el => {

    // Desktop: click works normally
    el.addEventListener("mousedown", (e) => {
      e.preventDefault();
      selectOffense(el.getAttribute("data-offense"));
    });

    // Mobile: tap selects, scroll does NOT select
    let startY = 0;
    let startX = 0;
    let moved = false;

    el.addEventListener("touchstart", (e) => {
      moved = false;
      startY = e.touches[0].clientY;
      startX = e.touches[0].clientX;
    }, { passive: true });

    el.addEventListener("touchmove", (e) => {
      const dy = Math.abs(e.touches[0].clientY - startY);
      const dx = Math.abs(e.touches[0].clientX - startX);
      if (dy > 8 || dx > 8) moved = true;
    }, { passive: true });

    el.addEventListener("touchend", () => {
      if (moved) return;
      selectOffense(el.getAttribute("data-offense"));
    });

  }); // closes forEach

} // closes showSuggestions


  function hideSuggestions() {
    const box = document.getElementById("suggestions");
    box.hidden = true;
    box.innerHTML = "";
  }

  function selectOffense(offenseText) {
    const input = document.getElementById("offenseInput");
    input.value = offenseText;

    selectedRow = matrix.find(r => r.offense === offenseText) || null;
    isLockedSelection = true;

    hideSuggestions();
    renderAction(selectedRow);
  }

  function handleTyping() {
    const input = document.getElementById("offenseInput");
    const q = input.value;

    // Any typing unlocks selection (resume "top match while typing")
    isLockedSelection = false;
    selectedRow = null;

    const matches = getMatches(q);
    showSuggestions(matches);

    // Show action for top match immediately (no label)
    renderAction(matches.length ? matches[0] : null);
  }

  function openDropdown() {
    const input = document.getElementById("offenseInput");
    const matches = getMatches(input.value);
    showSuggestions(matches);

    // If not locked, show top match while browsing/typing
    if (!(isLockedSelection && selectedRow)) {
      renderAction(matches.length ? matches[0] : null);
    }
  }

  async function init() {
    const input = document.getElementById("offenseInput");
    const countSel = document.getElementById("count");
    const wrap = document.querySelector(".inputWrap");

    const res = await fetch("data.json", { cache: "no-store" });
    matrix = await res.json();

    // Precompute search fields
    matrix.forEach(r => {
      r._searchKey = makeSearchKey(r.offense);
      r._tokens = tokenize(r.offense);
    });

    // Sort alphabetically for "browse all"
    matrix.sort((a,b) => a.offense.localeCompare(b.offense));

    // Type to filter
    input.addEventListener("input", handleTyping);

    // Click/focus to browse all (Option A)
    input.addEventListener("focus", openDropdown);
    input.addEventListener("click", openDropdown);

    // Count change: respect locked selection, otherwise keep using top match
    countSel.addEventListener("change", () => {
      if (isLockedSelection && selectedRow) renderAction(selectedRow);
      else renderAction(topMatch(input.value));
    });

    // Hide suggestions if clicking outside
    document.addEventListener("click", (e) => {
      if (wrap && !wrap.contains(e.target)) hideSuggestions();
    });

    document.getElementById("actionText").textContent =
      "Type or click the offense box to browse all offenses.";
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, s => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[s]));
  }

  init().catch(err => {
    console.error(err);
    document.getElementById("actionText").textContent =
      "Could not load data.json. Make sure data.json is in the same folder as index.html.";
  });
</script>
</body>
</html>
   
