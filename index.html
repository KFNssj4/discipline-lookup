<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Discipline Action Lookup</title>
  <style>
    :root { --border:#e5e7eb; --text:#111827; --muted:#6b7280; --bg:#f9fafb; --danger:#b91c1c; --dangerBg:#fee2e2; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text); }
    .wrap { max-width: 860px; margin: 40px auto; padding: 0 16px; }
    .card { background:white; border:1px solid var(--border); border-radius:14px; padding:20px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    h1 { font-size: 20px; margin: 0 0 12px; }
    p { margin: 0 0 18px; color: var(--muted); }
    .grid { display:grid; grid-template-columns: 1fr 220px; gap: 12px; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom:6px; }
    select {
      width: 100%; padding: 10px 12px; border:1px solid var(--border); border-radius:10px;
      font-size: 14px; background:white;
    }
    .notice {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(185, 28, 28, .35);
      background: var(--dangerBg);
      color: var(--danger);
      font-weight: 650;
      display: none;
    }
    .result { margin-top: 12px; padding: 14px; border:1px solid var(--border); border-radius:12px; background:#fff; }
    .result h2 { font-size: 14px; margin:0 0 6px; color: var(--muted); }
    .result .action { font-size: 18px; font-weight: 650; line-height:1.35; white-space: pre-line; }
    .footer { margin-top: 12px; font-size: 12px; color: var(--muted); }
    @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Discipline Action Lookup</h1>
      <p>Select an offense and the infraction count to see the recommended action.</p>

      <div class="grid">
        <div>
          <label for="offense">Offense</label>
          <select id="offense"></select>
        </div>

        <div>
          <label for="count">Infraction count</label>
          <select id="count">
            <option value="1">1st offense</option>
            <option value="2">2nd offense</option>
            <option value="3">3rd+ offense</option>
          </select>
        </div>
      </div>

      <div class="notice" id="unlawfulNotice">Unlawful act (may require law enforcement / district reporting per policy).</div>

      <div class="result" id="result" aria-live="polite">
        <h2>Action</h2>
        <div class="action" id="actionText">Loading…</div>
        <div class="footer" id="meta"></div>
      </div>
    </div>
  </div>

<script>
  let matrix = [];

  function normalizeCount(v) {
    const n = Number(v);
    if (Number.isNaN(n) || n <= 1) return 1;
    if (n === 2) return 2;
    return 3; // 3 or more
  }

  function getAction(row, count) {
    if (!row) return "Select a valid offense.";
    const c = normalizeCount(count);
    if (c === 1) return row.action1 || "(No action listed for 1st offense)";
    if (c === 2) return row.action2 || "(No action listed for 2nd offense)";
    return row.action3 || "(No action listed for 3rd+ offense)";
  }

  function render() {
    const offenseSel = document.getElementById("offense");
    const countSel = document.getElementById("count");
    const actionText = document.getElementById("actionText");
    const meta = document.getElementById("meta");
    const notice = document.getElementById("unlawfulNotice");

    const offense = offenseSel.value;
    const count = countSel.value;

    const row = matrix.find(r => r.offense === offense);

    // Action output
    actionText.textContent = getAction(row, count);

    // Unlawful notice
    if (row && row.unlawful === true) {
      notice.style.display = "block";
    } else {
      notice.style.display = "none";
    }

    const label = count === "1" ? "1st" : (count === "2" ? "2nd" : "3rd+");
    meta.textContent = row ? `${offense} • ${label} offense` : "";
  }

  async function init() {
    const offenseSel = document.getElementById("offense");
    const countSel = document.getElementById("count");

    const res = await fetch("data.json", { cache: "no-store" });
    matrix = await res.json();

    // Sort offenses alphabetically for nicer UX
    matrix.sort((a,b) => a.offense.localeCompare(b.offense));

    // Populate dropdown
    offenseSel.innerHTML =
      `<option value="" disabled selected>Select an offense…</option>` +
      matrix.map(r => `<option value="${escapeHtml(r.offense)}">${escapeHtml(r.offense)}</option>`).join("");

    offenseSel.addEventListener("change", render);
    countSel.addEventListener("change", render);

    document.getElementById("actionText").textContent = "Select an offense to begin.";
  }

  // Simple HTML escaping
  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, s => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[s]));
  }

  init().catch(err => {
    console.error(err);
    document.getElementById("actionText").textContent =
      "Could not load data.json. Make sure data.json is in the same folder as index.html.";
  });
</script>
</body>
</html>
